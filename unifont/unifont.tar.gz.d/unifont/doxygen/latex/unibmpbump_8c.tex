\hypertarget{unibmpbump_8c}{}\doxysection{src/unibmpbump.c File Reference}
\label{unibmpbump_8c}\index{src/unibmpbump.c@{src/unibmpbump.c}}


unibmpbump -\/ Adjust a Microsoft bitmap (.bmp) file that was created by unihex2png but converted to .bmp  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
Include dependency graph for unibmpbump.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=260pt]{unibmpbump_8c__incl}
\end{center}
\end{figure}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{unibmpbump_8c_a1c6d5de492ac61ad29aec7aa9a436bbf}\label{unibmpbump_8c_a1c6d5de492ac61ad29aec7aa9a436bbf}} 
\#define \mbox{\hyperlink{unibmpbump_8c_a1c6d5de492ac61ad29aec7aa9a436bbf}{VERSION}}~\char`\"{}1.\+0\char`\"{}
\begin{DoxyCompactList}\small\item\em Version of this program. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{unibmpbump_8c_aadfd205e5b62832a2ef6266260cb55f1}\label{unibmpbump_8c_aadfd205e5b62832a2ef6266260cb55f1}} 
\#define \mbox{\hyperlink{unibmpbump_8c_aadfd205e5b62832a2ef6266260cb55f1}{MAX\+\_\+\+COMPRESSION\+\_\+\+METHOD}}~13
\begin{DoxyCompactList}\small\item\em Maximum supported compression method. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{unibmpbump_8c_a0ddf1224851353fc92bfbff6f499fa97}{main}} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\begin{DoxyCompactList}\small\item\em The main function. \end{DoxyCompactList}\item 
unsigned \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\+\_\+bytes}} (FILE $\ast$infp, int nbytes)
\begin{DoxyCompactList}\small\item\em Get from 1 to 4 bytes, inclusive, from input file. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{unibmpbump_8c_a58f734bf43b58f0f2c28fd4a0582c0f4}{regrid}} (unsigned $\ast$image\+\_\+bytes)
\begin{DoxyCompactList}\small\item\em After reading in the image, shift it. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
unibmpbump -\/ Adjust a Microsoft bitmap (.bmp) file that was created by unihex2png but converted to .bmp 

\begin{DoxyAuthor}{Author}
Paul Hardy, unifoundry $<$at$>$ unifoundry.\+com
\end{DoxyAuthor}
\begin{DoxyCopyright}{Copyright}
Copyright (C) 2019 Paul Hardy
\end{DoxyCopyright}
This program shifts the glyphs in a bitmap file to adjust an original PNG file that was saved in BMP format. This is so the result matches the format of a unihex2bmp image. This conversion then lets unibmp2hex decode the result.

Synopsis\+: unibmpbump \mbox{[}-\/iin\+\_\+file.\+bmp\mbox{]} \mbox{[}-\/oout\+\_\+file.\+bmp\mbox{]} 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{unibmpbump_8c_ace9584f7b69b95621366833332b30465}\label{unibmpbump_8c_ace9584f7b69b95621366833332b30465}} 
\index{unibmpbump.c@{unibmpbump.c}!get\_bytes@{get\_bytes}}
\index{get\_bytes@{get\_bytes}!unibmpbump.c@{unibmpbump.c}}
\doxysubsubsection{\texorpdfstring{get\_bytes()}{get\_bytes()}}
{\footnotesize\ttfamily unsigned get\+\_\+bytes (\begin{DoxyParamCaption}\item[{FILE $\ast$}]{infp,  }\item[{int}]{nbytes }\end{DoxyParamCaption})}



Get from 1 to 4 bytes, inclusive, from input file. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em infp} & Pointer to input file. \\
\hline
\mbox{\texttt{ in}}  & {\em nbytes} & Number of bytes to read, from 1 to 4, inclusive. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The unsigned 1 to 4 bytes in machine native endian format. 
\end{DoxyReturn}


Definition at line 487 of file unibmpbump.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{487                                             \{}
\DoxyCodeLine{488    \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{489    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} inchar[4];}
\DoxyCodeLine{490    \textcolor{keywordtype}{unsigned} inword;}
\DoxyCodeLine{491 }
\DoxyCodeLine{492    \textcolor{keywordflow}{for} (i = 0; i < nbytes; i++) \{}
\DoxyCodeLine{493       \textcolor{keywordflow}{if} (fread (\&inchar[i], 1, 1, infp) != 1) \{}
\DoxyCodeLine{494          inchar[i] = 0;}
\DoxyCodeLine{495       \}}
\DoxyCodeLine{496    \}}
\DoxyCodeLine{497    \textcolor{keywordflow}{for} (i = nbytes; i < 4; i++) inchar[i] = 0;}
\DoxyCodeLine{498 }
\DoxyCodeLine{499    inword = ((inchar[3] \& 0xFF) << 24) | ((inchar[2] \& 0xFF) << 16) |}
\DoxyCodeLine{500             ((inchar[1] \& 0xFF) <<  8) |  (inchar[0] \& 0xFF);}
\DoxyCodeLine{501 }
\DoxyCodeLine{502    \textcolor{keywordflow}{return} inword;}
\DoxyCodeLine{503 \}}

\end{DoxyCode}
\mbox{\Hypertarget{unibmpbump_8c_a0ddf1224851353fc92bfbff6f499fa97}\label{unibmpbump_8c_a0ddf1224851353fc92bfbff6f499fa97}} 
\index{unibmpbump.c@{unibmpbump.c}!main@{main}}
\index{main@{main}!unibmpbump.c@{unibmpbump.c}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]} }\end{DoxyParamCaption})}



The main function. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em argc} & The count of command line arguments. \\
\hline
\mbox{\texttt{ in}}  & {\em argv} & Pointer to array of command line arguments. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
This program exits with status EXIT\+\_\+\+SUCCESS. 
\end{DoxyReturn}


Definition at line 50 of file unibmpbump.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{50                                   \{}
\DoxyCodeLine{51 }
\DoxyCodeLine{52    \textcolor{comment}{/*}}
\DoxyCodeLine{53 \textcolor{comment}{      Values preserved from file header (first 14 bytes).}}
\DoxyCodeLine{54 \textcolor{comment}{   */}}
\DoxyCodeLine{55    \textcolor{keywordtype}{char} file\_format[3];       \textcolor{comment}{/* "{}BM"{} for original Windows format           */}}
\DoxyCodeLine{56    \textcolor{keywordtype}{unsigned} filesize;         \textcolor{comment}{/* size of file in bytes                      */}}
\DoxyCodeLine{57    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} rsvd\_hdr[4]; \textcolor{comment}{/* 4 reserved bytes                           */}}
\DoxyCodeLine{58    \textcolor{keywordtype}{unsigned} image\_start;      \textcolor{comment}{/* byte offset of image in file               */}}
\DoxyCodeLine{59 }
\DoxyCodeLine{60    \textcolor{comment}{/*}}
\DoxyCodeLine{61 \textcolor{comment}{      Values preserved from Device Independent Bitmap (DIB) Header.}}
\DoxyCodeLine{62 \textcolor{comment}{}}
\DoxyCodeLine{63 \textcolor{comment}{      The DIB fields below are in the standard 40-\/byte header.  Version}}
\DoxyCodeLine{64 \textcolor{comment}{      4 and version 5 headers have more information, mainly for color}}
\DoxyCodeLine{65 \textcolor{comment}{      information.  That is skipped over, because a valid glyph image}}
\DoxyCodeLine{66 \textcolor{comment}{      is just monochrome.}}
\DoxyCodeLine{67 \textcolor{comment}{   */}}
\DoxyCodeLine{68    \textcolor{keywordtype}{int} dib\_length;            \textcolor{comment}{/* in bytes, for parsing by header version    */}}
\DoxyCodeLine{69    \textcolor{keywordtype}{int} image\_width = 0;       \textcolor{comment}{/* Signed image width                         */}}
\DoxyCodeLine{70    \textcolor{keywordtype}{int} image\_height = 0;      \textcolor{comment}{/* Signed image height                        */}}
\DoxyCodeLine{71    \textcolor{keywordtype}{int} num\_planes = 0;        \textcolor{comment}{/* number of planes; must be 1                */}}
\DoxyCodeLine{72    \textcolor{keywordtype}{int} bits\_per\_pixel = 0;    \textcolor{comment}{/* for palletized color maps (< 2\string^16 colors)  */}}
\DoxyCodeLine{73    \textcolor{comment}{/*}}
\DoxyCodeLine{74 \textcolor{comment}{      The following fields are not in the original spec, so initialize}}
\DoxyCodeLine{75 \textcolor{comment}{      them to 0 so we can correctly parse an original file format.}}
\DoxyCodeLine{76 \textcolor{comment}{   */}}
\DoxyCodeLine{77    \textcolor{keywordtype}{int} compression\_method=0;  \textcolor{comment}{/* 0 -\/-\/> uncompressed RGB/monochrome          */}}
\DoxyCodeLine{78    \textcolor{keywordtype}{int} image\_size = 0;        \textcolor{comment}{/* 0 is a valid size if no compression        */}}
\DoxyCodeLine{79    \textcolor{keywordtype}{int} hres = 0;              \textcolor{comment}{/* image horizontal resolution                */}}
\DoxyCodeLine{80    \textcolor{keywordtype}{int} vres = 0;              \textcolor{comment}{/* image vertical resolution                  */}}
\DoxyCodeLine{81    \textcolor{keywordtype}{int} num\_colors = 0;        \textcolor{comment}{/* Number of colors for pallettized images    */}}
\DoxyCodeLine{82    \textcolor{keywordtype}{int} important\_colors = 0;  \textcolor{comment}{/* Number of significant colors (0 or 2)      */}}
\DoxyCodeLine{83 }
\DoxyCodeLine{84    \textcolor{keywordtype}{int} true\_colors = 0;       \textcolor{comment}{/* interpret num\_colors, which can equal 0    */}}
\DoxyCodeLine{85 }
\DoxyCodeLine{86    \textcolor{comment}{/*}}
\DoxyCodeLine{87 \textcolor{comment}{      Color map.  This should be a monochrome file, so only two}}
\DoxyCodeLine{88 \textcolor{comment}{      colors are stored.}}
\DoxyCodeLine{89 \textcolor{comment}{   */}}
\DoxyCodeLine{90    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} color\_map[2][4]; \textcolor{comment}{/* two of R, G, B, and possibly alpha  */}}
\DoxyCodeLine{91 }
\DoxyCodeLine{92    \textcolor{comment}{/*}}
\DoxyCodeLine{93 \textcolor{comment}{      The monochrome image bitmap, stored as a vector 544 rows by}}
\DoxyCodeLine{94 \textcolor{comment}{      72*8 columns.}}
\DoxyCodeLine{95 \textcolor{comment}{   */}}
\DoxyCodeLine{96    \textcolor{keywordtype}{unsigned} image\_bytes[544*72];}
\DoxyCodeLine{97 }
\DoxyCodeLine{98    \textcolor{comment}{/*}}
\DoxyCodeLine{99 \textcolor{comment}{      Flags for conversion \& I/O.}}
\DoxyCodeLine{100 \textcolor{comment}{   */}}
\DoxyCodeLine{101    \textcolor{keywordtype}{int} verbose      = 0;      \textcolor{comment}{/* Whether to print file info on stderr     */}}
\DoxyCodeLine{102    \textcolor{keywordtype}{unsigned} image\_xor = 0x00; \textcolor{comment}{/* Invert (= 0xFF) if color 0 is not black  */}}
\DoxyCodeLine{103 }
\DoxyCodeLine{104    \textcolor{comment}{/*}}
\DoxyCodeLine{105 \textcolor{comment}{      Temporary variables.}}
\DoxyCodeLine{106 \textcolor{comment}{   */}}
\DoxyCodeLine{107    \textcolor{keywordtype}{int} i, j, k;           \textcolor{comment}{/* loop variables */}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109    \textcolor{comment}{/* Compression type, for parsing file */}}
\DoxyCodeLine{110    \textcolor{keywordtype}{char} *compression\_type[\mbox{\hyperlink{unibmpbump_8c_aadfd205e5b62832a2ef6266260cb55f1}{MAX\_COMPRESSION\_METHOD}} + 1] = \{}
\DoxyCodeLine{111       \textcolor{stringliteral}{"{}BI\_RGB"{}},            \textcolor{comment}{/*  0 */}}
\DoxyCodeLine{112       \textcolor{stringliteral}{"{}BI\_RLE8"{}},           \textcolor{comment}{/*  1 */}}
\DoxyCodeLine{113       \textcolor{stringliteral}{"{}BI\_RLE4"{}},           \textcolor{comment}{/*  2 */}}
\DoxyCodeLine{114       \textcolor{stringliteral}{"{}BI\_BITFIELDS"{}},      \textcolor{comment}{/*  3 */}}
\DoxyCodeLine{115       \textcolor{stringliteral}{"{}BI\_JPEG"{}},           \textcolor{comment}{/*  4 */}}
\DoxyCodeLine{116       \textcolor{stringliteral}{"{}BI\_PNG"{}},            \textcolor{comment}{/*  5 */}}
\DoxyCodeLine{117       \textcolor{stringliteral}{"{}BI\_ALPHABITFIELDS"{}}, \textcolor{comment}{/*  6 */}}
\DoxyCodeLine{118       \textcolor{stringliteral}{"{}"{}}, \textcolor{stringliteral}{"{}"{}}, \textcolor{stringliteral}{"{}"{}}, \textcolor{stringliteral}{"{}"{}},      \textcolor{comment}{/*  7 -\/ 10 */}}
\DoxyCodeLine{119       \textcolor{stringliteral}{"{}BI\_CMYK"{}},           \textcolor{comment}{/* 11 */}}
\DoxyCodeLine{120       \textcolor{stringliteral}{"{}BI\_CMYKRLE8"{}},       \textcolor{comment}{/* 12 */}}
\DoxyCodeLine{121       \textcolor{stringliteral}{"{}BI\_CMYKRLE4"{}},       \textcolor{comment}{/* 13 */}}
\DoxyCodeLine{122    \};}
\DoxyCodeLine{123 }
\DoxyCodeLine{124    \textcolor{comment}{/* Standard unihex2bmp.c header for BMP image */}}
\DoxyCodeLine{125    \textcolor{keywordtype}{unsigned} standard\_header [62] = \{}
\DoxyCodeLine{126       \textcolor{comment}{/*  0 */} 0x42, 0x4d, 0x3e, 0x99, 0x00, 0x00, 0x00, 0x00,}
\DoxyCodeLine{127       \textcolor{comment}{/*  8 */} 0x00, 0x00, 0x3e, 0x00, 0x00, 0x00, 0x28, 0x00,}
\DoxyCodeLine{128       \textcolor{comment}{/* 16 */} 0x00, 0x00, 0x40, 0x02, 0x00, 0x00, 0x20, 0x02,}
\DoxyCodeLine{129       \textcolor{comment}{/* 24 */} 0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00, 0x00,}
\DoxyCodeLine{130       \textcolor{comment}{/* 32 */} 0x00, 0x00, 0x00, 0x99, 0x00, 0x00, 0xc4, 0x0e,}
\DoxyCodeLine{131       \textcolor{comment}{/* 40 */} 0x00, 0x00, 0xc4, 0x0e, 0x00, 0x00, 0x00, 0x00,}
\DoxyCodeLine{132       \textcolor{comment}{/* 48 */} 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,}
\DoxyCodeLine{133       \textcolor{comment}{/* 56 */} 0x00, 0x00, 0xff, 0xff, 0xff, 0x00}
\DoxyCodeLine{134    \};}
\DoxyCodeLine{135 }
\DoxyCodeLine{136    \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (FILE *, \textcolor{keywordtype}{int});}
\DoxyCodeLine{137    \textcolor{keywordtype}{void}     \mbox{\hyperlink{unibmpbump_8c_a58f734bf43b58f0f2c28fd4a0582c0f4}{regrid}}    (\textcolor{keywordtype}{unsigned} *);}
\DoxyCodeLine{138 }
\DoxyCodeLine{139    \textcolor{keywordtype}{char} *infile=\textcolor{stringliteral}{"{}"{}}, *outfile=\textcolor{stringliteral}{"{}"{}};  \textcolor{comment}{/* names of input and output files         */}}
\DoxyCodeLine{140    FILE *infp, *outfp;            \textcolor{comment}{/* file pointers of input and output files */}}
\DoxyCodeLine{141 }
\DoxyCodeLine{142    \textcolor{comment}{/*}}
\DoxyCodeLine{143 \textcolor{comment}{      Process command line arguments.}}
\DoxyCodeLine{144 \textcolor{comment}{   */}}
\DoxyCodeLine{145    \textcolor{keywordflow}{if} (argc > 1) \{}
\DoxyCodeLine{146       \textcolor{keywordflow}{for} (i = 1; i < argc; i++) \{}
\DoxyCodeLine{147          \textcolor{keywordflow}{if} (argv[i][0] == \textcolor{charliteral}{'-\/'}) \{  \textcolor{comment}{/* this is an option argument */}}
\DoxyCodeLine{148             \textcolor{keywordflow}{switch} (argv[i][1]) \{}
\DoxyCodeLine{149                \textcolor{keywordflow}{case} \textcolor{charliteral}{'i'}:  \textcolor{comment}{/* name of input file */}}
\DoxyCodeLine{150                   infile = \&argv[i][2];}
\DoxyCodeLine{151                   \textcolor{keywordflow}{break};}
\DoxyCodeLine{152                \textcolor{keywordflow}{case} \textcolor{charliteral}{'o'}:  \textcolor{comment}{/* name of output file */}}
\DoxyCodeLine{153                   outfile = \&argv[i][2];}
\DoxyCodeLine{154                   \textcolor{keywordflow}{break};}
\DoxyCodeLine{155                \textcolor{keywordflow}{case} \textcolor{charliteral}{'v'}:  \textcolor{comment}{/* verbose output */}}
\DoxyCodeLine{156                   verbose = 1;}
\DoxyCodeLine{157                   \textcolor{keywordflow}{break};}
\DoxyCodeLine{158                \textcolor{keywordflow}{case} \textcolor{charliteral}{'V'}:  \textcolor{comment}{/* print version \& quit */}}
\DoxyCodeLine{159                   fprintf (stderr, \textcolor{stringliteral}{"{}unibmpbump version \%s\(\backslash\)n\(\backslash\)n"{}}, \mbox{\hyperlink{unibmpbump_8c_a1c6d5de492ac61ad29aec7aa9a436bbf}{VERSION}});}
\DoxyCodeLine{160                   exit (EXIT\_SUCCESS);}
\DoxyCodeLine{161                   \textcolor{keywordflow}{break};}
\DoxyCodeLine{162                \textcolor{keywordflow}{case} \textcolor{charliteral}{'-\/'}:  \textcolor{comment}{/* see if "{}-\/-\/verbose"{} */}}
\DoxyCodeLine{163                   \textcolor{keywordflow}{if} (strcmp (argv[i], \textcolor{stringliteral}{"{}-\/-\/verbose"{}}) == 0) \{}
\DoxyCodeLine{164                      verbose = 1;}
\DoxyCodeLine{165                   \}}
\DoxyCodeLine{166                   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp (argv[i], \textcolor{stringliteral}{"{}-\/-\/version"{}}) == 0) \{}
\DoxyCodeLine{167                      fprintf (stderr, \textcolor{stringliteral}{"{}unibmpbump version \%s\(\backslash\)n\(\backslash\)n"{}}, \mbox{\hyperlink{unibmpbump_8c_a1c6d5de492ac61ad29aec7aa9a436bbf}{VERSION}});}
\DoxyCodeLine{168                      exit (EXIT\_SUCCESS);}
\DoxyCodeLine{169                   \}}
\DoxyCodeLine{170                   \textcolor{keywordflow}{break};}
\DoxyCodeLine{171                \textcolor{keywordflow}{default}:   \textcolor{comment}{/* if unrecognized option, print list and exit */}}
\DoxyCodeLine{172                   fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)nSyntax:\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{173                   fprintf (stderr, \textcolor{stringliteral}{"{}   unibmpbump "{}});}
\DoxyCodeLine{174                   fprintf (stderr, \textcolor{stringliteral}{"{}-\/i<Input\_File> -\/o<Output\_File>\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{175                   fprintf (stderr, \textcolor{stringliteral}{"{}-\/v or -\/-\/verbose gives verbose output"{}});}
\DoxyCodeLine{176                   fprintf (stderr, \textcolor{stringliteral}{"{} on stderr\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{177                   fprintf (stderr, \textcolor{stringliteral}{"{}-\/V or -\/-\/version prints version"{}});}
\DoxyCodeLine{178                   fprintf (stderr, \textcolor{stringliteral}{"{} on stderr and exits\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{179                   fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)nExample:\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{180                   fprintf (stderr, \textcolor{stringliteral}{"{}   unibmpbump -\/iuni0101.bmp"{}});}
\DoxyCodeLine{181                   fprintf (stderr, \textcolor{stringliteral}{"{} -\/onew-\/uni0101.bmp\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{182                   exit (EXIT\_SUCCESS);}
\DoxyCodeLine{183             \}}
\DoxyCodeLine{184          \}}
\DoxyCodeLine{185       \}}
\DoxyCodeLine{186    \}}
\DoxyCodeLine{187 }
\DoxyCodeLine{188    \textcolor{comment}{/*}}
\DoxyCodeLine{189 \textcolor{comment}{      Make sure we can open any I/O files that were specified before}}
\DoxyCodeLine{190 \textcolor{comment}{      doing anything else.}}
\DoxyCodeLine{191 \textcolor{comment}{   */}}
\DoxyCodeLine{192    \textcolor{keywordflow}{if} (strlen (infile) > 0) \{}
\DoxyCodeLine{193       \textcolor{keywordflow}{if} ((infp = fopen (infile, \textcolor{stringliteral}{"{}r"{}})) == NULL) \{}
\DoxyCodeLine{194          fprintf (stderr, \textcolor{stringliteral}{"{}Error: can't open \%s for input.\(\backslash\)n"{}}, infile);}
\DoxyCodeLine{195          exit (EXIT\_FAILURE);}
\DoxyCodeLine{196       \}}
\DoxyCodeLine{197    \}}
\DoxyCodeLine{198    \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{199       infp = stdin;}
\DoxyCodeLine{200    \}}
\DoxyCodeLine{201    \textcolor{keywordflow}{if} (strlen (outfile) > 0) \{}
\DoxyCodeLine{202       \textcolor{keywordflow}{if} ((outfp = fopen (outfile, \textcolor{stringliteral}{"{}w"{}})) == NULL) \{}
\DoxyCodeLine{203          fprintf (stderr, \textcolor{stringliteral}{"{}Error: can't open \%s for output.\(\backslash\)n"{}}, outfile);}
\DoxyCodeLine{204          exit (EXIT\_FAILURE);}
\DoxyCodeLine{205       \}}
\DoxyCodeLine{206    \}}
\DoxyCodeLine{207    \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{208       outfp = stdout;}
\DoxyCodeLine{209    \}}
\DoxyCodeLine{210 }
\DoxyCodeLine{211 }
\DoxyCodeLine{212    \textcolor{comment}{/* Read bitmap file header */}}
\DoxyCodeLine{213    file\_format[0] = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 1);}
\DoxyCodeLine{214    file\_format[1] = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 1);}
\DoxyCodeLine{215    file\_format[2] = \textcolor{charliteral}{'\(\backslash\)0'};  \textcolor{comment}{/* Terminate string with null */}}
\DoxyCodeLine{216 }
\DoxyCodeLine{217    \textcolor{comment}{/* Read file size */}}
\DoxyCodeLine{218    filesize = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 4);}
\DoxyCodeLine{219 }
\DoxyCodeLine{220    \textcolor{comment}{/* Read Reserved bytes */}}
\DoxyCodeLine{221    rsvd\_hdr[0] = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 1);}
\DoxyCodeLine{222    rsvd\_hdr[1] = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 1);}
\DoxyCodeLine{223    rsvd\_hdr[2] = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 1);}
\DoxyCodeLine{224    rsvd\_hdr[3] = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 1);}
\DoxyCodeLine{225 }
\DoxyCodeLine{226    \textcolor{comment}{/* Read Image Offset Address within file */}}
\DoxyCodeLine{227    image\_start = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 4);}
\DoxyCodeLine{228 }
\DoxyCodeLine{229    \textcolor{comment}{/*}}
\DoxyCodeLine{230 \textcolor{comment}{      See if this looks like a valid image file based on}}
\DoxyCodeLine{231 \textcolor{comment}{      the file header first two bytes.}}
\DoxyCodeLine{232 \textcolor{comment}{   */}}
\DoxyCodeLine{233    \textcolor{keywordflow}{if} (strncmp (file\_format, \textcolor{stringliteral}{"{}BM"{}}, 2) != 0) \{}
\DoxyCodeLine{234       fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)nInvalid file format: not file type \(\backslash\)"{}BM\(\backslash\)"{}.\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{235       exit (EXIT\_FAILURE);}
\DoxyCodeLine{236    \}}
\DoxyCodeLine{237 }
\DoxyCodeLine{238    \textcolor{keywordflow}{if} (verbose) \{}
\DoxyCodeLine{239       fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)nFile Header:\(\backslash\)n"{}});}
\DoxyCodeLine{240       fprintf (stderr, \textcolor{stringliteral}{"{}   File Type:   \(\backslash\)"{}\%s\(\backslash\)"{}\(\backslash\)n"{}}, file\_format);}
\DoxyCodeLine{241       fprintf (stderr, \textcolor{stringliteral}{"{}   File Size:   \%d bytes\(\backslash\)n"{}}, filesize);}
\DoxyCodeLine{242       fprintf (stderr, \textcolor{stringliteral}{"{}   Reserved:   "{}});}
\DoxyCodeLine{243       \textcolor{keywordflow}{for} (i = 0; i < 4; i++) fprintf (stderr, \textcolor{stringliteral}{"{} 0x\%02X"{}}, rsvd\_hdr[i]);}
\DoxyCodeLine{244       fputc (\textcolor{charliteral}{'\(\backslash\)n'}, stderr);}
\DoxyCodeLine{245       fprintf (stderr, \textcolor{stringliteral}{"{}   Image Start: \%d. = 0x\%02X = 0\%05o\(\backslash\)n\(\backslash\)n"{}},}
\DoxyCodeLine{246                image\_start, image\_start, image\_start);}
\DoxyCodeLine{247    \}  \textcolor{comment}{/* if (verbose) */}}
\DoxyCodeLine{248 }
\DoxyCodeLine{249    \textcolor{comment}{/*}}
\DoxyCodeLine{250 \textcolor{comment}{      Device Independent Bitmap (DIB) Header: bitmap information header}}
\DoxyCodeLine{251 \textcolor{comment}{      ("{}BM"{} format file DIB Header is 12 bytes long).}}
\DoxyCodeLine{252 \textcolor{comment}{   */}}
\DoxyCodeLine{253    dib\_length = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 4);}
\DoxyCodeLine{254 }
\DoxyCodeLine{255    \textcolor{comment}{/*}}
\DoxyCodeLine{256 \textcolor{comment}{      Parse one of three versions of Device Independent Bitmap (DIB) format:}}
\DoxyCodeLine{257 \textcolor{comment}{}}
\DoxyCodeLine{258 \textcolor{comment}{           Length  Format}}
\DoxyCodeLine{259 \textcolor{comment}{           -\/-\/-\/-\/-\/-\/  -\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{260 \textcolor{comment}{              12   BITMAPCOREHEADER}}
\DoxyCodeLine{261 \textcolor{comment}{              40   BITMAPINFOHEADER}}
\DoxyCodeLine{262 \textcolor{comment}{             108   BITMAPV4HEADER}}
\DoxyCodeLine{263 \textcolor{comment}{             124   BITMAPV5HEADER}}
\DoxyCodeLine{264 \textcolor{comment}{   */}}
\DoxyCodeLine{265    \textcolor{keywordflow}{if} (dib\_length == 12) \{ \textcolor{comment}{/* BITMAPCOREHEADER format -\/-\/ UNTESTED */}}
\DoxyCodeLine{266       image\_width    = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 2);}
\DoxyCodeLine{267       image\_height   = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 2);}
\DoxyCodeLine{268       num\_planes     = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 2);}
\DoxyCodeLine{269       bits\_per\_pixel = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 2);}
\DoxyCodeLine{270    \}}
\DoxyCodeLine{271    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (dib\_length >= 40) \{ \textcolor{comment}{/* BITMAPINFOHEADER format or later */}}
\DoxyCodeLine{272       image\_width = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 4);}
\DoxyCodeLine{273       image\_height       = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 4);}
\DoxyCodeLine{274       num\_planes         = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 2);}
\DoxyCodeLine{275       bits\_per\_pixel     = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 2);}
\DoxyCodeLine{276       compression\_method = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 4);  \textcolor{comment}{/* BI\_BITFIELDS */}}
\DoxyCodeLine{277       image\_size         = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 4);}
\DoxyCodeLine{278       hres               = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 4);}
\DoxyCodeLine{279       vres               = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 4);}
\DoxyCodeLine{280       num\_colors         = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 4);}
\DoxyCodeLine{281       important\_colors   = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 4);}
\DoxyCodeLine{282 }
\DoxyCodeLine{283       \textcolor{comment}{/* true\_colors is true number of colors in image */}}
\DoxyCodeLine{284       \textcolor{keywordflow}{if} (num\_colors == 0)}
\DoxyCodeLine{285          true\_colors = 1 << bits\_per\_pixel;}
\DoxyCodeLine{286       \textcolor{keywordflow}{else}}
\DoxyCodeLine{287          true\_colors = num\_colors;}
\DoxyCodeLine{288 }
\DoxyCodeLine{289       \textcolor{comment}{/*}}
\DoxyCodeLine{290 \textcolor{comment}{         If dib\_length > 40, the format is BITMAPV4HEADER or}}
\DoxyCodeLine{291 \textcolor{comment}{         BITMAPV5HEADER.  As this program is only designed}}
\DoxyCodeLine{292 \textcolor{comment}{         to handle a monochrome image, we can ignore the rest}}
\DoxyCodeLine{293 \textcolor{comment}{         of the header but must read past the remaining bytes.}}
\DoxyCodeLine{294 \textcolor{comment}{      */}}
\DoxyCodeLine{295       \textcolor{keywordflow}{for} (i = 40; i < dib\_length; i++) (\textcolor{keywordtype}{void})\mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 1);}
\DoxyCodeLine{296    \}}
\DoxyCodeLine{297 }
\DoxyCodeLine{298    \textcolor{keywordflow}{if} (verbose) \{}
\DoxyCodeLine{299       fprintf (stderr, \textcolor{stringliteral}{"{}Device Independent Bitmap (DIB) Header:\(\backslash\)n"{}});}
\DoxyCodeLine{300       fprintf (stderr, \textcolor{stringliteral}{"{}   DIB Length:  \%9d bytes (version = "{}}, dib\_length);}
\DoxyCodeLine{301 }
\DoxyCodeLine{302       \textcolor{keywordflow}{if}      (dib\_length ==  12) fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)"{}BITMAPCOREHEADER\(\backslash\)"{})\(\backslash\)n"{}});}
\DoxyCodeLine{303       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (dib\_length ==  40) fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)"{}BITMAPINFOHEADER\(\backslash\)"{})\(\backslash\)n"{}});}
\DoxyCodeLine{304       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (dib\_length == 108) fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)"{}BITMAPV4HEADER\(\backslash\)"{})\(\backslash\)n"{}});}
\DoxyCodeLine{305       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (dib\_length == 124) fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)"{}BITMAPV5HEADER\(\backslash\)"{})\(\backslash\)n"{}});}
\DoxyCodeLine{306       \textcolor{keywordflow}{else} fprintf (stderr, \textcolor{stringliteral}{"{}unknown)"{}});}
\DoxyCodeLine{307       fprintf (stderr, \textcolor{stringliteral}{"{}   Bitmap Width:   \%6d pixels\(\backslash\)n"{}}, image\_width);}
\DoxyCodeLine{308       fprintf (stderr, \textcolor{stringliteral}{"{}   Bitmap Height:  \%6d pixels\(\backslash\)n"{}}, image\_height);}
\DoxyCodeLine{309       fprintf (stderr, \textcolor{stringliteral}{"{}   Color Planes:   \%6d\(\backslash\)n"{}},        num\_planes);}
\DoxyCodeLine{310       fprintf (stderr, \textcolor{stringliteral}{"{}   Bits per Pixel: \%6d\(\backslash\)n"{}},        bits\_per\_pixel);}
\DoxyCodeLine{311       fprintf (stderr, \textcolor{stringliteral}{"{}   Compression Method: \%2d -\/-\/> "{}}, compression\_method);}
\DoxyCodeLine{312       \textcolor{keywordflow}{if} (compression\_method <= \mbox{\hyperlink{unibmpbump_8c_aadfd205e5b62832a2ef6266260cb55f1}{MAX\_COMPRESSION\_METHOD}}) \{}
\DoxyCodeLine{313          fprintf (stderr, \textcolor{stringliteral}{"{}\%s"{}}, compression\_type [compression\_method]);}
\DoxyCodeLine{314       \}}
\DoxyCodeLine{315       \textcolor{comment}{/*}}
\DoxyCodeLine{316 \textcolor{comment}{         Supported compression method values:}}
\DoxyCodeLine{317 \textcolor{comment}{              0 -\/-\/> uncompressed RGB}}
\DoxyCodeLine{318 \textcolor{comment}{             11 -\/-\/> uncompressed CMYK}}
\DoxyCodeLine{319 \textcolor{comment}{      */}}
\DoxyCodeLine{320       \textcolor{keywordflow}{if} (compression\_method == 0 || compression\_method == 11) \{}
\DoxyCodeLine{321          fprintf (stderr, \textcolor{stringliteral}{"{} (no compression)"{}});}
\DoxyCodeLine{322       \}}
\DoxyCodeLine{323       \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{324          fprintf (stderr, \textcolor{stringliteral}{"{}Image uses compression; this is unsupported.\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{325          exit (EXIT\_FAILURE);}
\DoxyCodeLine{326       \}}
\DoxyCodeLine{327       fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{328       fprintf (stderr, \textcolor{stringliteral}{"{}   Image Size:            \%5d bytes\(\backslash\)n"{}}, image\_size);}
\DoxyCodeLine{329       fprintf (stderr, \textcolor{stringliteral}{"{}   Horizontal Resolution: \%5d pixels/meter\(\backslash\)n"{}}, hres);}
\DoxyCodeLine{330       fprintf (stderr, \textcolor{stringliteral}{"{}   Vertical Resolution:   \%5d pixels/meter\(\backslash\)n"{}}, vres);}
\DoxyCodeLine{331       fprintf (stderr, \textcolor{stringliteral}{"{}   Number of Colors:      \%5d"{}}, num\_colors);}
\DoxyCodeLine{332       \textcolor{keywordflow}{if} (num\_colors != true\_colors) \{}
\DoxyCodeLine{333          fprintf (stderr, \textcolor{stringliteral}{"{} -\/-\/> \%d"{}}, true\_colors);}
\DoxyCodeLine{334       \}}
\DoxyCodeLine{335       fputc (\textcolor{charliteral}{'\(\backslash\)n'}, stderr);}
\DoxyCodeLine{336       fprintf (stderr, \textcolor{stringliteral}{"{}   Important Colors:      \%5d"{}}, important\_colors);}
\DoxyCodeLine{337       \textcolor{keywordflow}{if} (important\_colors == 0)}
\DoxyCodeLine{338          fprintf (stderr, \textcolor{stringliteral}{"{} (all colors are important)"{}});}
\DoxyCodeLine{339       fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{340    \}  \textcolor{comment}{/* if (verbose) */}}
\DoxyCodeLine{341 }
\DoxyCodeLine{342    \textcolor{comment}{/*}}
\DoxyCodeLine{343 \textcolor{comment}{      Print Color Table information for images with pallettized colors.}}
\DoxyCodeLine{344 \textcolor{comment}{   */}}
\DoxyCodeLine{345    \textcolor{keywordflow}{if} (bits\_per\_pixel <= 8) \{}
\DoxyCodeLine{346       \textcolor{keywordflow}{for} (i = 0; i < 2; i++) \{}
\DoxyCodeLine{347          color\_map [i][0] = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 1);}
\DoxyCodeLine{348          color\_map [i][1] = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 1);}
\DoxyCodeLine{349          color\_map [i][2] = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 1);}
\DoxyCodeLine{350          color\_map [i][3] = \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 1);}
\DoxyCodeLine{351       \}}
\DoxyCodeLine{352       \textcolor{comment}{/* Skip remaining color table entries if more than 2 */}}
\DoxyCodeLine{353       \textcolor{keywordflow}{while} (i < true\_colors) \{}
\DoxyCodeLine{354          (void) \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 4);}
\DoxyCodeLine{355          i++;}
\DoxyCodeLine{356       \}}
\DoxyCodeLine{357 }
\DoxyCodeLine{358       \textcolor{keywordflow}{if} (color\_map [0][0] >= 128) image\_xor = 0xFF;  \textcolor{comment}{/* Invert colors */}}
\DoxyCodeLine{359    \}}
\DoxyCodeLine{360 }
\DoxyCodeLine{361    \textcolor{keywordflow}{if} (verbose) \{}
\DoxyCodeLine{362       fprintf (stderr, \textcolor{stringliteral}{"{}Color Palette [R, G, B, \%s] Values:\(\backslash\)n"{}},}
\DoxyCodeLine{363                (dib\_length <= 40) ? \textcolor{stringliteral}{"{}reserved"{}} : \textcolor{stringliteral}{"{}Alpha"{}});}
\DoxyCodeLine{364       \textcolor{keywordflow}{for} (i = 0; i < 2; i++) \{}
\DoxyCodeLine{365          fprintf (stderr, \textcolor{stringliteral}{"{}\%7d: ["{}}, i);}
\DoxyCodeLine{366          fprintf (stderr, \textcolor{stringliteral}{"{}\%3d,"{}},   color\_map [i][0] \& 0xFF);}
\DoxyCodeLine{367          fprintf (stderr, \textcolor{stringliteral}{"{}\%3d,"{}},   color\_map [i][1] \& 0xFF);}
\DoxyCodeLine{368          fprintf (stderr, \textcolor{stringliteral}{"{}\%3d,"{}},   color\_map [i][2] \& 0xFF);}
\DoxyCodeLine{369          fprintf (stderr, \textcolor{stringliteral}{"{}\%3d]\(\backslash\)n"{}}, color\_map [i][3] \& 0xFF);}
\DoxyCodeLine{370       \}}
\DoxyCodeLine{371       \textcolor{keywordflow}{if} (image\_xor == 0xFF) fprintf (stderr, \textcolor{stringliteral}{"{}Will Invert Colors.\(\backslash\)n"{}});}
\DoxyCodeLine{372       fputc (\textcolor{charliteral}{'\(\backslash\)n'}, stderr);}
\DoxyCodeLine{373 }
\DoxyCodeLine{374    \}  \textcolor{comment}{/* if (verbose) */}}
\DoxyCodeLine{375 }
\DoxyCodeLine{376 }
\DoxyCodeLine{377    \textcolor{comment}{/*}}
\DoxyCodeLine{378 \textcolor{comment}{      Check format before writing output file.}}
\DoxyCodeLine{379 \textcolor{comment}{   */}}
\DoxyCodeLine{380    \textcolor{keywordflow}{if} (image\_width != 560 \&\& image\_width != 576) \{}
\DoxyCodeLine{381       fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)nUnsupported image width: \%d\(\backslash\)n"{}}, image\_width);}
\DoxyCodeLine{382       fprintf (stderr, \textcolor{stringliteral}{"{}Width should be 560 or 576 pixels.\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{383       exit (EXIT\_FAILURE);}
\DoxyCodeLine{384    \}}
\DoxyCodeLine{385 }
\DoxyCodeLine{386    \textcolor{keywordflow}{if} (image\_height != 544) \{}
\DoxyCodeLine{387       fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)nUnsupported image height: \%d\(\backslash\)n"{}}, image\_height);}
\DoxyCodeLine{388       fprintf (stderr, \textcolor{stringliteral}{"{}Height should be 544 pixels.\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{389       exit (EXIT\_FAILURE);}
\DoxyCodeLine{390    \}}
\DoxyCodeLine{391 }
\DoxyCodeLine{392    \textcolor{keywordflow}{if} (num\_planes != 1) \{}
\DoxyCodeLine{393       fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)nUnsupported number of planes: \%d\(\backslash\)n"{}}, num\_planes);}
\DoxyCodeLine{394       fprintf (stderr, \textcolor{stringliteral}{"{}Number of planes should be 1.\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{395       exit (EXIT\_FAILURE);}
\DoxyCodeLine{396    \}}
\DoxyCodeLine{397 }
\DoxyCodeLine{398    \textcolor{keywordflow}{if} (bits\_per\_pixel != 1) \{}
\DoxyCodeLine{399       fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)nUnsupported number of bits per pixel: \%d\(\backslash\)n"{}},}
\DoxyCodeLine{400                bits\_per\_pixel);}
\DoxyCodeLine{401       fprintf (stderr, \textcolor{stringliteral}{"{}Bits per pixel should be 1.\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{402       exit (EXIT\_FAILURE);}
\DoxyCodeLine{403    \}}
\DoxyCodeLine{404 }
\DoxyCodeLine{405    \textcolor{keywordflow}{if} (compression\_method != 0 \&\& compression\_method != 11) \{}
\DoxyCodeLine{406       fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)nUnsupported compression method: \%d\(\backslash\)n"{}},}
\DoxyCodeLine{407                compression\_method);}
\DoxyCodeLine{408       fprintf (stderr, \textcolor{stringliteral}{"{}Compression method should be 1 or 11.\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{409       exit (EXIT\_FAILURE);}
\DoxyCodeLine{410    \}}
\DoxyCodeLine{411 }
\DoxyCodeLine{412    \textcolor{keywordflow}{if} (true\_colors != 2) \{}
\DoxyCodeLine{413       fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)nUnsupported number of colors: \%d\(\backslash\)n"{}}, true\_colors);}
\DoxyCodeLine{414       fprintf (stderr, \textcolor{stringliteral}{"{}Number of colors should be 2.\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{415       exit (EXIT\_FAILURE);}
\DoxyCodeLine{416    \}}
\DoxyCodeLine{417 }
\DoxyCodeLine{418 }
\DoxyCodeLine{419    \textcolor{comment}{/*}}
\DoxyCodeLine{420 \textcolor{comment}{      If we made it this far, things look okay, so write out}}
\DoxyCodeLine{421 \textcolor{comment}{      the standard header for image conversion.}}
\DoxyCodeLine{422 \textcolor{comment}{   */}}
\DoxyCodeLine{423    \textcolor{keywordflow}{for} (i = 0; i < 62; i++) fputc (standard\_header[i], outfp);}
\DoxyCodeLine{424 }
\DoxyCodeLine{425 }
\DoxyCodeLine{426    \textcolor{comment}{/*}}
\DoxyCodeLine{427 \textcolor{comment}{      Image Data.  Each row must be a multiple of 4 bytes, with}}
\DoxyCodeLine{428 \textcolor{comment}{      padding at the end of each row if necessary.}}
\DoxyCodeLine{429 \textcolor{comment}{   */}}
\DoxyCodeLine{430    k = 0;  \textcolor{comment}{/* byte number within the binary image */}}
\DoxyCodeLine{431    \textcolor{keywordflow}{for} (i = 0; i < 544; i++) \{}
\DoxyCodeLine{432       \textcolor{comment}{/*}}
\DoxyCodeLine{433 \textcolor{comment}{         If original image is 560 pixels wide (not 576), add}}
\DoxyCodeLine{434 \textcolor{comment}{         2 white bytes at beginning of row.}}
\DoxyCodeLine{435 \textcolor{comment}{      */}}
\DoxyCodeLine{436       \textcolor{keywordflow}{if} (image\_width == 560) \{  \textcolor{comment}{/* Insert 2 white bytes */}}
\DoxyCodeLine{437          image\_bytes[k++] = 0xFF;}
\DoxyCodeLine{438          image\_bytes[k++] = 0xFF;}
\DoxyCodeLine{439       \}}
\DoxyCodeLine{440       \textcolor{keywordflow}{for} (j = 0; j < 70; j++) \{  \textcolor{comment}{/* Copy next 70 bytes */}}
\DoxyCodeLine{441          image\_bytes[k++] = (\mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 1) \& 0xFF) \string^ image\_xor;}
\DoxyCodeLine{442       \}}
\DoxyCodeLine{443       \textcolor{comment}{/*}}
\DoxyCodeLine{444 \textcolor{comment}{         If original image is 560 pixels wide (not 576), skip}}
\DoxyCodeLine{445 \textcolor{comment}{         2 padding bytes at end of row in file because we inserted}}
\DoxyCodeLine{446 \textcolor{comment}{         2 white bytes at the beginning of the row.}}
\DoxyCodeLine{447 \textcolor{comment}{      */}}
\DoxyCodeLine{448       \textcolor{keywordflow}{if} (image\_width == 560) \{}
\DoxyCodeLine{449          (void) \mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 2);}
\DoxyCodeLine{450       \}}
\DoxyCodeLine{451       \textcolor{keywordflow}{else} \{  \textcolor{comment}{/* otherwise, next 2 bytes are part of the image so copy them */}}
\DoxyCodeLine{452          image\_bytes[k++] = (\mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 1) \& 0xFF) \string^ image\_xor;}
\DoxyCodeLine{453          image\_bytes[k++] = (\mbox{\hyperlink{unibmpbump_8c_ace9584f7b69b95621366833332b30465}{get\_bytes}} (infp, 1) \& 0xFF) \string^ image\_xor;}
\DoxyCodeLine{454       \}}
\DoxyCodeLine{455    \}}
\DoxyCodeLine{456 }
\DoxyCodeLine{457 }
\DoxyCodeLine{458    \textcolor{comment}{/*}}
\DoxyCodeLine{459 \textcolor{comment}{      Change the image to match the unihex2bmp.c format if original wasn't}}
\DoxyCodeLine{460 \textcolor{comment}{   */}}
\DoxyCodeLine{461    \textcolor{keywordflow}{if} (image\_width == 560) \{}
\DoxyCodeLine{462       \mbox{\hyperlink{unibmpbump_8c_a58f734bf43b58f0f2c28fd4a0582c0f4}{regrid}} (image\_bytes);}
\DoxyCodeLine{463    \}}
\DoxyCodeLine{464 }
\DoxyCodeLine{465    \textcolor{keywordflow}{for} (i = 0; i < 544 * 576 / 8; i++) \{}
\DoxyCodeLine{466       fputc (image\_bytes[i], outfp);}
\DoxyCodeLine{467    \}}
\DoxyCodeLine{468 }
\DoxyCodeLine{469 }
\DoxyCodeLine{470    \textcolor{comment}{/*}}
\DoxyCodeLine{471 \textcolor{comment}{      Wrap up.}}
\DoxyCodeLine{472 \textcolor{comment}{   */}}
\DoxyCodeLine{473    fclose (infp);}
\DoxyCodeLine{474    fclose (outfp);}
\DoxyCodeLine{475 }
\DoxyCodeLine{476    exit (EXIT\_SUCCESS);}
\DoxyCodeLine{477 \}}

\end{DoxyCode}
\mbox{\Hypertarget{unibmpbump_8c_a58f734bf43b58f0f2c28fd4a0582c0f4}\label{unibmpbump_8c_a58f734bf43b58f0f2c28fd4a0582c0f4}} 
\index{unibmpbump.c@{unibmpbump.c}!regrid@{regrid}}
\index{regrid@{regrid}!unibmpbump.c@{unibmpbump.c}}
\doxysubsubsection{\texorpdfstring{regrid()}{regrid()}}
{\footnotesize\ttfamily void regrid (\begin{DoxyParamCaption}\item[{unsigned $\ast$}]{image\+\_\+bytes }\end{DoxyParamCaption})}



After reading in the image, shift it. 

This function adjusts the input image from an original PNG file to match \mbox{\hyperlink{unihex2bmp_8c}{unihex2bmp.\+c}} format.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in,out}}  & {\em image\+\_\+bytes} & The pixels in an image. \\
\hline
\end{DoxyParams}


Definition at line 514 of file unibmpbump.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{514                                     \{}
\DoxyCodeLine{515    \textcolor{keywordtype}{int} i, j, k;  \textcolor{comment}{/* loop variables */}}
\DoxyCodeLine{516    \textcolor{keywordtype}{int} offset;}
\DoxyCodeLine{517    \textcolor{keywordtype}{unsigned} glyph\_row; \textcolor{comment}{/* one grid row of 32 pixels */}}
\DoxyCodeLine{518    \textcolor{keywordtype}{unsigned} last\_pixel; \textcolor{comment}{/* last pixel in a byte, to preserve */}}
\DoxyCodeLine{519 }
\DoxyCodeLine{520    \textcolor{comment}{/* To insert "{}00"{} after "{}U+"{} at top of image */}}
\DoxyCodeLine{521    \textcolor{keywordtype}{char} zero\_pattern[16] = \{}
\DoxyCodeLine{522        0x00, 0x00, 0x00, 0x00, 0x18, 0x24, 0x42, 0x42,}
\DoxyCodeLine{523        0x42, 0x42, 0x42, 0x42, 0x24, 0x18, 0x00, 0x00}
\DoxyCodeLine{524    \};}
\DoxyCodeLine{525 }
\DoxyCodeLine{526    \textcolor{comment}{/* This is the horizontal grid pattern on glyph boundaries */}}
\DoxyCodeLine{527    \textcolor{keywordtype}{unsigned} hgrid[72] = \{}
\DoxyCodeLine{528       \textcolor{comment}{/*  0 */} 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe,}
\DoxyCodeLine{529       \textcolor{comment}{/*  8 */} 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00,}
\DoxyCodeLine{530       \textcolor{comment}{/* 16 */} 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00,}
\DoxyCodeLine{531       \textcolor{comment}{/* 24 */} 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00,}
\DoxyCodeLine{532       \textcolor{comment}{/* 32 */} 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00,}
\DoxyCodeLine{533       \textcolor{comment}{/* 40 */} 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00,}
\DoxyCodeLine{534       \textcolor{comment}{/* 48 */} 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00,}
\DoxyCodeLine{535       \textcolor{comment}{/* 56 */} 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00,}
\DoxyCodeLine{536       \textcolor{comment}{/* 64 */} 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00}
\DoxyCodeLine{537    \};}
\DoxyCodeLine{538 }
\DoxyCodeLine{539 }
\DoxyCodeLine{540    \textcolor{comment}{/*}}
\DoxyCodeLine{541 \textcolor{comment}{      First move "{}U+"{} left and insert "{}00"{} after it.}}
\DoxyCodeLine{542 \textcolor{comment}{   */}}
\DoxyCodeLine{543    j = 15; \textcolor{comment}{/* rows are written bottom to top, so we'll decrement j */}}
\DoxyCodeLine{544    \textcolor{keywordflow}{for} (i = 543 -\/ 8; i > 544 -\/ 24; i-\/-\/) \{}
\DoxyCodeLine{545       offset = 72 * i;}
\DoxyCodeLine{546       image\_bytes [offset + 0] = image\_bytes [offset + 2];}
\DoxyCodeLine{547       image\_bytes [offset + 1] = image\_bytes [offset + 3];}
\DoxyCodeLine{548       image\_bytes [offset + 2] = image\_bytes [offset + 4];}
\DoxyCodeLine{549       image\_bytes [offset + 3] = image\_bytes [offset + 4] =}
\DoxyCodeLine{550          \string~zero\_pattern[15 -\/ j-\/-\/] \& 0xFF;}
\DoxyCodeLine{551    \}}
\DoxyCodeLine{552 }
\DoxyCodeLine{553    \textcolor{comment}{/*}}
\DoxyCodeLine{554 \textcolor{comment}{      Now move glyph bitmaps to the right by 8 pixels.}}
\DoxyCodeLine{555 \textcolor{comment}{   */}}
\DoxyCodeLine{556    \textcolor{keywordflow}{for} (i = 0; i < 16; i++) \{ \textcolor{comment}{/* for each glyph row */}}
\DoxyCodeLine{557       \textcolor{keywordflow}{for} (j = 0; j < 16; j++) \{ \textcolor{comment}{/* for each glyph column */}}
\DoxyCodeLine{558          \textcolor{comment}{/* set offset to lower left-\/hand byte of next glyph */}}
\DoxyCodeLine{559          offset = (32 * 72 * i) + (9 * 72) + (4 * j) + 8;}
\DoxyCodeLine{560          \textcolor{keywordflow}{for} (k = 0; k < 16; k++) \{ \textcolor{comment}{/* for each glyph row */}}
\DoxyCodeLine{561             glyph\_row = (image\_bytes [offset + 0] << 24) |}
\DoxyCodeLine{562                         (image\_bytes [offset + 1] << 16) |}
\DoxyCodeLine{563                         (image\_bytes [offset + 2] <<  8) |}
\DoxyCodeLine{564                         (image\_bytes [offset + 3]);}
\DoxyCodeLine{565             last\_pixel = glyph\_row \& 1;  \textcolor{comment}{/* preserve border */}}
\DoxyCodeLine{566             glyph\_row >>= 4;}
\DoxyCodeLine{567             glyph\_row \&=  0x0FFFFFFE;}
\DoxyCodeLine{568             \textcolor{comment}{/* Set left 4 pixels to white and preserve last pixel */}}
\DoxyCodeLine{569             glyph\_row |=  0xF0000000 | last\_pixel;}
\DoxyCodeLine{570             image\_bytes [offset + 3] = glyph\_row \& 0xFF;}
\DoxyCodeLine{571             glyph\_row >>= 8;}
\DoxyCodeLine{572             image\_bytes [offset + 2] = glyph\_row \& 0xFF;}
\DoxyCodeLine{573             glyph\_row >>= 8;}
\DoxyCodeLine{574             image\_bytes [offset + 1] = glyph\_row \& 0xFF;}
\DoxyCodeLine{575             glyph\_row >>= 8;}
\DoxyCodeLine{576             image\_bytes [offset + 0] = glyph\_row \& 0xFF;}
\DoxyCodeLine{577             offset += 72;  \textcolor{comment}{/* move up to next row in current glyph */}}
\DoxyCodeLine{578          \}}
\DoxyCodeLine{579       \}}
\DoxyCodeLine{580    \}}
\DoxyCodeLine{581 }
\DoxyCodeLine{582    \textcolor{comment}{/* Replace horizontal grid with unihex2bmp.c grid */}}
\DoxyCodeLine{583    \textcolor{keywordflow}{for} (i = 0; i <= 16; i++) \{}
\DoxyCodeLine{584       offset = 32 * 72 * i;}
\DoxyCodeLine{585       \textcolor{keywordflow}{for} (j = 0; j < 72; j++) \{}
\DoxyCodeLine{586          image\_bytes [offset + j] = hgrid [j];}
\DoxyCodeLine{587       \}}
\DoxyCodeLine{588    \}}
\DoxyCodeLine{589 }
\DoxyCodeLine{590    \textcolor{keywordflow}{return};}
\DoxyCodeLine{591 \}}

\end{DoxyCode}
