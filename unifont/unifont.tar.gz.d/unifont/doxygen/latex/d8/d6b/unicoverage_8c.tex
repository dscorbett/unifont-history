\hypertarget{unicoverage_8c}{}\doxysection{src/unicoverage.c File Reference}
\label{unicoverage_8c}\index{src/unicoverage.c@{src/unicoverage.c}}


unicoverage -\/ Show the coverage of Unicode plane scripts for a G\+NU Unifont hex glyph file  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
Include dependency graph for unicoverage.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=273pt]{df/d50/unicoverage_8c__incl}
\end{center}
\end{figure}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{unicoverage_8c_ad7871643c05865c80f5d8050aead2b57}\label{unicoverage_8c_ad7871643c05865c80f5d8050aead2b57}} 
\#define \mbox{\hyperlink{unicoverage_8c_ad7871643c05865c80f5d8050aead2b57}{M\+A\+X\+B\+UF}}~256
\begin{DoxyCompactList}\small\item\em Maximum input line length -\/ 1. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{unicoverage_8c_a0ddf1224851353fc92bfbff6f499fa97}{main}} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\begin{DoxyCompactList}\small\item\em The main function. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{unicoverage_8c_aecb35821cec5af4455f392b872cc1dc4}{nextrange}} (F\+I\+LE $\ast$coveragefp, int $\ast$cstart, int $\ast$cend, char $\ast$coverstring)
\begin{DoxyCompactList}\small\item\em Get next Unicode range. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{unicoverage_8c_acfeab2c5c5e91c5343674cb7c523911f}{print\+\_\+subtotal}} (F\+I\+LE $\ast$outfp, int print\+\_\+n, int nglyphs, int cstart, int cend, char $\ast$coverstring)
\begin{DoxyCompactList}\small\item\em Print the subtotal for one Unicode script range. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
unicoverage -\/ Show the coverage of Unicode plane scripts for a G\+NU Unifont hex glyph file 

\begin{DoxyAuthor}{Author}
Paul Hardy, unifoundry $<$at$>$ unifoundry.\+com, 6 January 2008
\end{DoxyAuthor}
\begin{DoxyCopyright}{Copyright}
Copyright (C) 2008, 2013 Paul Hardy
\end{DoxyCopyright}
Synopsis\+: unicoverage \mbox{[}-\/ifont\+\_\+file.\+hex\mbox{]} \mbox{[}-\/ocoverage\+\_\+file.\+txt\mbox{]}

This program requires the file \char`\"{}coverage.\+dat\char`\"{} to be present in the directory from which it is run. 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{unicoverage_8c_a0ddf1224851353fc92bfbff6f499fa97}\label{unicoverage_8c_a0ddf1224851353fc92bfbff6f499fa97}} 
\index{unicoverage.c@{unicoverage.c}!main@{main}}
\index{main@{main}!unicoverage.c@{unicoverage.c}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]} }\end{DoxyParamCaption})}



The main function. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em argc} & The count of command line arguments. \\
\hline
\mbox{\texttt{ in}}  & {\em argv} & Pointer to array of command line arguments. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
This program exits with status 0. 
\end{DoxyReturn}


Definition at line 68 of file unicoverage.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{69 \{}
\DoxyCodeLine{70 }
\DoxyCodeLine{71    \textcolor{keywordtype}{int}      print\_n=0;        \textcolor{comment}{/* print \# of glyphs, not percentage   */}}
\DoxyCodeLine{72    \textcolor{keywordtype}{unsigned} i;                \textcolor{comment}{/* loop variable                       */}}
\DoxyCodeLine{73    \textcolor{keywordtype}{unsigned} slen;             \textcolor{comment}{/* string length of coverage file line */}}
\DoxyCodeLine{74    \textcolor{keywordtype}{char}     inbuf[256];       \textcolor{comment}{/* input buffer                        */}}
\DoxyCodeLine{75    \textcolor{keywordtype}{unsigned} thischar;         \textcolor{comment}{/* the current character               */}}
\DoxyCodeLine{76 }
\DoxyCodeLine{77    \textcolor{keywordtype}{char} *infile=\textcolor{stringliteral}{"{}"{}}, *outfile=\textcolor{stringliteral}{"{}"{}};  \textcolor{comment}{/* names of input and output files        */}}
\DoxyCodeLine{78    FILE *infp, *outfp;        \textcolor{comment}{/* file pointers of input and output files    */}}
\DoxyCodeLine{79    FILE *coveragefp;          \textcolor{comment}{/* file pointer to coverage.dat file          */}}
\DoxyCodeLine{80    \textcolor{keywordtype}{int} cstart, cend;          \textcolor{comment}{/* current coverage start and end code points */}}
\DoxyCodeLine{81    \textcolor{keywordtype}{char} coverstring[\mbox{\hyperlink{unicoverage_8c_ad7871643c05865c80f5d8050aead2b57}{MAXBUF}}];  \textcolor{comment}{/* description of current coverage range      */}}
\DoxyCodeLine{82    \textcolor{keywordtype}{int} nglyphs;               \textcolor{comment}{/* number of glyphs in this section           */}}
\DoxyCodeLine{83    \textcolor{keywordtype}{int} \mbox{\hyperlink{unicoverage_8c_aecb35821cec5af4455f392b872cc1dc4}{nextrange}}();           \textcolor{comment}{/* to get next range \& name of Unicode glyphs */}}
\DoxyCodeLine{84 }
\DoxyCodeLine{85    \textcolor{keywordtype}{void} \mbox{\hyperlink{unicoverage_8c_acfeab2c5c5e91c5343674cb7c523911f}{print\_subtotal}} (FILE *outfp, \textcolor{keywordtype}{int} print\_n, \textcolor{keywordtype}{int} nglyphs,}
\DoxyCodeLine{86                         \textcolor{keywordtype}{int} cstart, \textcolor{keywordtype}{int} cend, \textcolor{keywordtype}{char} *coverstring);}
\DoxyCodeLine{87 }
\DoxyCodeLine{88    \textcolor{keywordflow}{if} ((coveragefp = fopen (\textcolor{stringliteral}{"{}coverage.dat"{}}, \textcolor{stringliteral}{"{}r"{}})) == NULL) \{}
\DoxyCodeLine{89       fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)nError: data file \(\backslash\)"{}coverage.dat\(\backslash\)"{} not found.\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{90       exit (0);}
\DoxyCodeLine{91    \}}
\DoxyCodeLine{92 }
\DoxyCodeLine{93    \textcolor{keywordflow}{if} (argc > 1) \{}
\DoxyCodeLine{94       \textcolor{keywordflow}{for} (i = 1; i < argc; i++) \{}
\DoxyCodeLine{95          \textcolor{keywordflow}{if} (argv[i][0] == \textcolor{charliteral}{'-\/'}) \{  \textcolor{comment}{/* this is an option argument */}}
\DoxyCodeLine{96             \textcolor{keywordflow}{switch} (argv[i][1]) \{}
\DoxyCodeLine{97                \textcolor{keywordflow}{case} \textcolor{charliteral}{'i'}:  \textcolor{comment}{/* name of input file */}}
\DoxyCodeLine{98                   infile = \&argv[i][2];}
\DoxyCodeLine{99                   \textcolor{keywordflow}{break};}
\DoxyCodeLine{100                \textcolor{keywordflow}{case} \textcolor{charliteral}{'n'}:  \textcolor{comment}{/* print number of glyphs instead of percentage */}}
\DoxyCodeLine{101                   print\_n = 1;}
\DoxyCodeLine{102                \textcolor{keywordflow}{case} \textcolor{charliteral}{'o'}:  \textcolor{comment}{/* name of output file */}}
\DoxyCodeLine{103                   outfile = \&argv[i][2];}
\DoxyCodeLine{104                   \textcolor{keywordflow}{break};}
\DoxyCodeLine{105                \textcolor{keywordflow}{default}:   \textcolor{comment}{/* if unrecognized option, print list and exit */}}
\DoxyCodeLine{106                   fprintf (stderr, \textcolor{stringliteral}{"{}\(\backslash\)nSyntax:\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{107                   fprintf (stderr, \textcolor{stringliteral}{"{}   \%s -\/p<Unicode\_Page> "{}}, argv[0]);}
\DoxyCodeLine{108                   fprintf (stderr, \textcolor{stringliteral}{"{}-\/i<Input\_File> -\/o<Output\_File> -\/w\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{109                   exit (1);}
\DoxyCodeLine{110             \}}
\DoxyCodeLine{111          \}}
\DoxyCodeLine{112       \}}
\DoxyCodeLine{113    \}}
\DoxyCodeLine{114    \textcolor{comment}{/*}}
\DoxyCodeLine{115 \textcolor{comment}{      Make sure we can open any I/O files that were specified before}}
\DoxyCodeLine{116 \textcolor{comment}{      doing anything else.}}
\DoxyCodeLine{117 \textcolor{comment}{   */}}
\DoxyCodeLine{118    \textcolor{keywordflow}{if} (strlen (infile) > 0) \{}
\DoxyCodeLine{119       \textcolor{keywordflow}{if} ((infp = fopen (infile, \textcolor{stringliteral}{"{}r"{}})) == NULL) \{}
\DoxyCodeLine{120          fprintf (stderr, \textcolor{stringliteral}{"{}Error: can't open \%s for input.\(\backslash\)n"{}}, infile);}
\DoxyCodeLine{121          exit (1);}
\DoxyCodeLine{122       \}}
\DoxyCodeLine{123    \}}
\DoxyCodeLine{124    \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{125       infp = stdin;}
\DoxyCodeLine{126    \}}
\DoxyCodeLine{127    \textcolor{keywordflow}{if} (strlen (outfile) > 0) \{}
\DoxyCodeLine{128       \textcolor{keywordflow}{if} ((outfp = fopen (outfile, \textcolor{stringliteral}{"{}w"{}})) == NULL) \{}
\DoxyCodeLine{129          fprintf (stderr, \textcolor{stringliteral}{"{}Error: can't open \%s for output.\(\backslash\)n"{}}, outfile);}
\DoxyCodeLine{130          exit (1);}
\DoxyCodeLine{131       \}}
\DoxyCodeLine{132    \}}
\DoxyCodeLine{133    \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{134       outfp = stdout;}
\DoxyCodeLine{135    \}}
\DoxyCodeLine{136 }
\DoxyCodeLine{137    \textcolor{comment}{/*}}
\DoxyCodeLine{138 \textcolor{comment}{      Print header row.}}
\DoxyCodeLine{139 \textcolor{comment}{   */}}
\DoxyCodeLine{140    \textcolor{keywordflow}{if} (print\_n) \{}
\DoxyCodeLine{141       fprintf (outfp, \textcolor{stringliteral}{"{}\# Glyphs      Range        Script\(\backslash\)n"{}});}
\DoxyCodeLine{142       fprintf (outfp, \textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/-\/-\/-\/      -\/-\/-\/-\/-\/        -\/-\/-\/-\/-\/-\/\(\backslash\)n"{}});}
\DoxyCodeLine{143    \}}
\DoxyCodeLine{144    \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{145       fprintf (outfp, \textcolor{stringliteral}{"{}Covered      Range        Script\(\backslash\)n"{}});}
\DoxyCodeLine{146       fprintf (outfp, \textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/-\/-\/      -\/-\/-\/-\/-\/        -\/-\/-\/-\/-\/-\/\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{147    \}}
\DoxyCodeLine{148 }
\DoxyCodeLine{149    slen = \mbox{\hyperlink{unicoverage_8c_aecb35821cec5af4455f392b872cc1dc4}{nextrange}} (coveragefp, \&cstart, \&cend, coverstring);}
\DoxyCodeLine{150    nglyphs = 0;}
\DoxyCodeLine{151 }
\DoxyCodeLine{152    \textcolor{comment}{/*}}
\DoxyCodeLine{153 \textcolor{comment}{      Read in the glyphs in the file}}
\DoxyCodeLine{154 \textcolor{comment}{   */}}
\DoxyCodeLine{155    \textcolor{keywordflow}{while} (slen != 0 \&\& fgets (inbuf, \mbox{\hyperlink{unicoverage_8c_ad7871643c05865c80f5d8050aead2b57}{MAXBUF}}-\/1, infp) != NULL) \{}
\DoxyCodeLine{156       sscanf (inbuf, \textcolor{stringliteral}{"{}\%x"{}}, \&thischar);}
\DoxyCodeLine{157 }
\DoxyCodeLine{158       \textcolor{comment}{/* Read a character beyond end of current script. */}}
\DoxyCodeLine{159       \textcolor{keywordflow}{while} (cend < thischar \&\& slen != 0) \{}
\DoxyCodeLine{160          \mbox{\hyperlink{unicoverage_8c_acfeab2c5c5e91c5343674cb7c523911f}{print\_subtotal}} (outfp, print\_n, nglyphs, cstart, cend, coverstring);}
\DoxyCodeLine{161 }
\DoxyCodeLine{162          \textcolor{comment}{/* start new range total */}}
\DoxyCodeLine{163          slen = \mbox{\hyperlink{unicoverage_8c_aecb35821cec5af4455f392b872cc1dc4}{nextrange}} (coveragefp, \&cstart, \&cend, coverstring);}
\DoxyCodeLine{164          nglyphs = 0;}
\DoxyCodeLine{165       \}}
\DoxyCodeLine{166       nglyphs++;}
\DoxyCodeLine{167    \}}
\DoxyCodeLine{168 }
\DoxyCodeLine{169    \mbox{\hyperlink{unicoverage_8c_acfeab2c5c5e91c5343674cb7c523911f}{print\_subtotal}} (outfp, print\_n, nglyphs, cstart, cend, coverstring);}
\DoxyCodeLine{170 }
\DoxyCodeLine{171    exit (0);}
\DoxyCodeLine{172 \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=241pt]{d8/d6b/unicoverage_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{unicoverage_8c_aecb35821cec5af4455f392b872cc1dc4}\label{unicoverage_8c_aecb35821cec5af4455f392b872cc1dc4}} 
\index{unicoverage.c@{unicoverage.c}!nextrange@{nextrange}}
\index{nextrange@{nextrange}!unicoverage.c@{unicoverage.c}}
\doxysubsubsection{\texorpdfstring{nextrange()}{nextrange()}}
{\footnotesize\ttfamily int nextrange (\begin{DoxyParamCaption}\item[{F\+I\+LE $\ast$}]{coveragefp,  }\item[{int $\ast$}]{cstart,  }\item[{int $\ast$}]{cend,  }\item[{char $\ast$}]{coverstring }\end{DoxyParamCaption})}



Get next Unicode range. 

This function reads the next Unicode script range to count its glyph coverage.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em coveragefp} & File pointer to Unicode script range data file. \\
\hline
\mbox{\texttt{ in}}  & {\em cstart} & Starting code point in current Unicode script range. \\
\hline
\mbox{\texttt{ in}}  & {\em cend} & Ending code point in current Unicode script range. \\
\hline
\mbox{\texttt{ out}}  & {\em coverstring} & String containing $<$cstart$>$-\/$<$cend$>$ substring. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Length of the last string read, or 0 for end of file. 
\end{DoxyReturn}


Definition at line 187 of file unicoverage.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{190 \{}
\DoxyCodeLine{191    \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{192    \textcolor{keyword}{static} \textcolor{keywordtype}{char} inbuf[\mbox{\hyperlink{unicoverage_8c_ad7871643c05865c80f5d8050aead2b57}{MAXBUF}}];}
\DoxyCodeLine{193    \textcolor{keywordtype}{int} retval;         \textcolor{comment}{/* the return value */}}
\DoxyCodeLine{194 }
\DoxyCodeLine{195    retval = 0;}
\DoxyCodeLine{196 }
\DoxyCodeLine{197    \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{198       \textcolor{keywordflow}{if} (fgets (inbuf, \mbox{\hyperlink{unicoverage_8c_ad7871643c05865c80f5d8050aead2b57}{MAXBUF}}-\/1, coveragefp) != NULL) \{}
\DoxyCodeLine{199          retval = strlen (inbuf);}
\DoxyCodeLine{200          \textcolor{keywordflow}{if} ((inbuf[0] >= \textcolor{charliteral}{'0'} \&\& inbuf[0] <= \textcolor{charliteral}{'9'}) ||}
\DoxyCodeLine{201              (inbuf[0] >= \textcolor{charliteral}{'A'} \&\& inbuf[0] <= \textcolor{charliteral}{'F'}) ||}
\DoxyCodeLine{202              (inbuf[0] >= \textcolor{charliteral}{'a'} \&\& inbuf[0] <= \textcolor{charliteral}{'f'})) \{}
\DoxyCodeLine{203             sscanf (inbuf, \textcolor{stringliteral}{"{}\%x-\/\%x"{}}, cstart, cend);}
\DoxyCodeLine{204             i = 0;}
\DoxyCodeLine{205             \textcolor{keywordflow}{while} (inbuf[i] != \textcolor{charliteral}{' '}) i++;  \textcolor{comment}{/* find first blank */}}
\DoxyCodeLine{206             \textcolor{keywordflow}{while} (inbuf[i] == \textcolor{charliteral}{' '}) i++;  \textcolor{comment}{/* find next non-\/blank */}}
\DoxyCodeLine{207             strncpy (coverstring, \&inbuf[i], \mbox{\hyperlink{unicoverage_8c_ad7871643c05865c80f5d8050aead2b57}{MAXBUF}});}
\DoxyCodeLine{208          \}}
\DoxyCodeLine{209          \textcolor{keywordflow}{else} retval = 0;}
\DoxyCodeLine{210       \}}
\DoxyCodeLine{211       \textcolor{keywordflow}{else} retval = 0;}
\DoxyCodeLine{212    \} \textcolor{keywordflow}{while} (retval == 0 \&\& !feof (coveragefp));}
\DoxyCodeLine{213 }
\DoxyCodeLine{214    \textcolor{keywordflow}{return} (retval);}
\DoxyCodeLine{215 \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=223pt]{d8/d6b/unicoverage_8c_aecb35821cec5af4455f392b872cc1dc4_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{unicoverage_8c_acfeab2c5c5e91c5343674cb7c523911f}\label{unicoverage_8c_acfeab2c5c5e91c5343674cb7c523911f}} 
\index{unicoverage.c@{unicoverage.c}!print\_subtotal@{print\_subtotal}}
\index{print\_subtotal@{print\_subtotal}!unicoverage.c@{unicoverage.c}}
\doxysubsubsection{\texorpdfstring{print\_subtotal()}{print\_subtotal()}}
{\footnotesize\ttfamily void print\+\_\+subtotal (\begin{DoxyParamCaption}\item[{F\+I\+LE $\ast$}]{outfp,  }\item[{int}]{print\+\_\+n,  }\item[{int}]{nglyphs,  }\item[{int}]{cstart,  }\item[{int}]{cend,  }\item[{char $\ast$}]{coverstring }\end{DoxyParamCaption})}



Print the subtotal for one Unicode script range. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em outfp} & Pointer to output file. \\
\hline
\mbox{\texttt{ in}}  & {\em print\+\_\+n} & 1 = print number of glyphs, 0 = print percentage. \\
\hline
\mbox{\texttt{ in}}  & {\em nglyphs} & Number of glyphs in current range. \\
\hline
\mbox{\texttt{ in}}  & {\em cstart} & Starting code point for current range. \\
\hline
\mbox{\texttt{ in}}  & {\em cend} & Ending code point for current range. \\
\hline
\mbox{\texttt{ in}}  & {\em coverstring} & Character string of \char`\"{}$<$cstart$>$-\/$<$cend$>$\char`\"{}. \\
\hline
\end{DoxyParams}


Definition at line 228 of file unicoverage.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{229                                                               \{}
\DoxyCodeLine{230 }
\DoxyCodeLine{231    \textcolor{comment}{/* print old range total */}}
\DoxyCodeLine{232    \textcolor{keywordflow}{if} (print\_n) \{  \textcolor{comment}{/* Print number of glyphs, not percentage */}}
\DoxyCodeLine{233       fprintf (outfp, \textcolor{stringliteral}{"{} \%6d "{}}, nglyphs);}
\DoxyCodeLine{234    \}}
\DoxyCodeLine{235    \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{236       fprintf (outfp, \textcolor{stringliteral}{"{} \%5.1f\%\%"{}}, 100.0*nglyphs/(1+cend-\/cstart));}
\DoxyCodeLine{237    \}}
\DoxyCodeLine{238 }
\DoxyCodeLine{239    \textcolor{keywordflow}{if} (cend < 0x10000)}
\DoxyCodeLine{240       fprintf (outfp, \textcolor{stringliteral}{"{}  U+\%04X..U+\%04X   \%s"{}},}
\DoxyCodeLine{241                cstart, cend, coverstring);}
\DoxyCodeLine{242    \textcolor{keywordflow}{else}}
\DoxyCodeLine{243       fprintf (outfp, \textcolor{stringliteral}{"{} U+\%05X..U+\%05X  \%s"{}},}
\DoxyCodeLine{244                cstart, cend, coverstring);}
\DoxyCodeLine{245 }
\DoxyCodeLine{246    \textcolor{keywordflow}{return};}
\DoxyCodeLine{247 \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=241pt]{d8/d6b/unicoverage_8c_acfeab2c5c5e91c5343674cb7c523911f_icgraph}
\end{center}
\end{figure}
